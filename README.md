
# page-capture-spike

This is a placeholder README.md for a new repository


## Server
### Start the server
Start the service from the `./server` directory with:
```bash
node server.js
```
The server will start on port 6001.

### Retrieve unique pages
Once a test run has been completed, and all of  the pages that you'd like to assess have been saved in the `./output` directory, execute the `identifyUniqueOutputFoldersByUrl.sh` script. Ensure that you change the `serverName` and `uniquePageDirectory` parameters.

You will also need to make sure that the output generated by the service is copied into the `service.log` file.  This output is required in order to sort and filter for unique URLs.


## Page Assessment
To assess all of the pages in a given folder (for example `./trusts-unique-pages`) execute `./assessAllPages.sh trusts-unique-pages` and all folders with names beginning with `1560` (timestamp) will have their `index.html` file assessed by axe, nu html validator and pa11y, and have reports generated in that same folder.


## Visualising a11y violations
We will build a tool which generates a json file which can be bulk uploaded to an elastic search instance.

### json schema
The each violation found will be stored as the below json object:
```json
{
    "tool": "String",
    "test_suite": "String",
    "path": "String",
    "timestamp": INT,
    "code": "String",
    "severity": "String",
    "description": "String",
    "selector": "String",
    "snippet": "String"
}
```
**tool**: the tool the violation was found with.  i.e. aXe, vnu or pa11y
**test_suite**: the test suite executed.  i.e. trusts-ui-test
**path**: the path part of the url stored in each page directory's `data` file.  i.e. `/trusts-registration/trust-registered-online`
**timestamp**: the timestamp integer used to name the directory

The following fields will be taken from the json reports generated by each tool:
**code**:
- pa11y -> code
- vnu -> there is no unique code for the issues raised. (!)
- aXe -> node.any[].id

**severity**:
- pa11y -> type
- vnu -> type
- aXe -> node.any[].impact

**description**:
- pa11y -> message
- vnu -> message
- aXe -> node.any[].message

**selector**:
- pa11y -> selector
- vnu -> there is no selector given in the vnu report (!)
- aXe -> node.any[].data{}

**snippet**:
- pa11y -> context
- vnu -> extract
- aXe -> nodes[].html


*Note:  In axe, capture only violations and incomplete scans, prefix incomplete scans with INCOMPLETE*


### License

This code is open source software licensed under the [Apache 2.0 License]("http://www.apache.org/licenses/LICENSE-2.0.html").
